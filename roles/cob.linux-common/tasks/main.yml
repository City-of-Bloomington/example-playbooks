---
# tasks file for cob.linux-common
- name: Make sure Root password is disabled
  user:
    name: root
    update_password: always 
    password: '!'

- command: apt-get update
  tags: [ apt_update, apt_upgrade ]

- command: apt-get upgrade -y
  tags: apt_upgrade

- name: Setup Unattended Upgrades
  lineinfile: dest=/etc/apt/apt.conf.d/50unattended-upgrades regexp="{{ item.regexp }}" line="{{ item.line }}"
  with_items:
  - { regexp: '\"\$\{distro_id\}\:\$\{distro_codename\}-updates\"\;', line: '    "${distro_id}:${distro_codename}-updates";' }
  - { regexp: 'Unattended-Upgrade\:\:Remove-Unused-Dependencies',     line: 'Unattended-Upgrade::Remove-Unused-Dependencies \"true\";' }
  - { regexp: 'Unattended-Upgrade\:\:Automatic-Reboot \"',            line: 'Unattended-Upgrade::Automatic-Reboot \"true\";' }
  tags: unattended

- name: Install common packages
  action: apt pkg={{ item }} state=present
  tags: common
  with_items: cob_common_packages

- name: Setup Firewall
  include: firewall.yml
  tags: firewall

- name: Setup NTP
  include: ntp.yml
  tags: ntp

- name: Setup VIM
  include: vim.yml
  tags: vim

- name: Setup Nano
  include: nano.yml
  tags: nano
